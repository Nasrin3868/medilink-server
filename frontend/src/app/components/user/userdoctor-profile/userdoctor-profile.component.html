<app-header></app-header>
<div class="app-container min-h-screen flex flex-col bg-gray-50">

    <main class="flex-grow p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto w-full">

        <div class="bg-white rounded-xl shadow-2xl p-6 sm:p-8 mb-8 border-t-4 border-red-500">
            <div class="flex flex-col md:flex-row items-center md:items-start md:space-x-8">
                
                <div class="mb-6 md:mb-0 flex-shrink-0">
                    <img *ngIf="doctor.profile_picture; else no_profile_picture" 
                          [src]="doctor.profile_picture" 
                          alt="Doctor's Profile" 
                          class="h-40 w-40 object-cover rounded-full shadow-xl border-4 border-gray-100" />
                    <ng-template #no_profile_picture>
                        <img src="https://res.cloudinary.com/dyemxd31x/image/upload/v1724227464/ank36p5bo7ypy79ya9me.jpg" 
                              alt="Doctor's Placeholder" 
                              class="w-40 h-40 object-cover rounded-full shadow-xl border-4 border-gray-100">
                    </ng-template>
                </div>
                
                <div class="text-center md:text-left flex-1">
                    <h2 class="text-3xl sm:text-4xl font-extrabold text-gray-900 leading-tight">
                        Dr. {{(doctor.firstName | capitalizeFirst) + ' ' + (doctor.lastName | capitalizeFirst)}}
                    </h2>
                    
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-3 text-sm sm:text-base font-semibold">
                        <p class="text-gray-700">Specialization:</p>
                        <p class="text-red-600 font-bold col-span-1 sm:col-span-3">{{doctor.specialization | capitalizeFirst}}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-1 text-sm sm:text-base">
                        <p class="text-gray-700">Consulting Fee:</p>
                        <p class="text-gray-900 font-extrabold col-span-1 sm:col-span-3">â‚¹{{doctor.consultation_fee}}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-1 text-sm sm:text-base">
                        <p class="text-gray-700">Experience:</p>
                        <p class="text-gray-900 col-span-1 sm:col-span-3">{{doctor.experience}} years</p>
                    </div>

                    <p class="text-gray-900 mt-6 mb-2 text-xl font-bold border-b border-gray-200 pb-1">About</p>
                    <p class="text-gray-700 text-justify leading-relaxed">
                        With a passion for {{doctor.specialization}} and a focus on compassionate care, Dr. {{(doctor.firstName | capitalizeFirst) + ' ' + (doctor.lastName | capitalizeFirst)}} believes in building trust and guiding patients toward better health outcomes.
                    </p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg border border-gray-200">
            <ul class="flex flex-wrap text-sm sm:text-base font-semibold text-center text-gray-600 border-b border-gray-200 bg-gray-50 rounded-t-xl" id="defaultTab" role="tablist">
                
                <li class="flex-1 me-2 sm:flex-initial">
                    <button (click)="selectTab('about')"
                        [ngClass]="{'bg-white text-red-600 shadow-md': selectedTab === 'about', 'hover:text-gray-900 hover:bg-gray-100': selectedTab !== 'about'}"
                        class="inline-block w-full p-4 rounded-tl-xl transition-all duration-300">
                        Select your slots
                    </button>
                </li>
                
                <li class="flex-1 sm:flex-initial">
                    <button (click)="selectTab('services')"
                        [ngClass]="{'bg-white text-red-600 shadow-md': selectedTab === 'services', 'hover:text-gray-900 hover:bg-gray-100': selectedTab !== 'services'}"
                        class="inline-block w-full p-4 transition-all duration-300">
                        Connect with your doctor
                    </button>
                </li>
            </ul>
        
            <div id="defaultTabContent" class="p-4 sm:p-6 lg:p-8">
                <div *ngIf="selectedTab === 'about'" class="bg-white" role="tabpanel">
                    <div class="grid md:grid-cols-2 gap-8">
                        
                        <div class="flex flex-col justify-start">
                            <label class="text-xl font-bold text-gray-900 mb-4">Select your date:</label>
                            
                            <div class="rounded-xl shadow-lg border border-gray-200 p-2 max-w-full overflow-x-auto">
                                <p-calendar 
                                    [(ngModel)]="date" 
                                    (ngModelChange)="getSlotsForDisplay($event)" 
                                    [minDate]="minDate" 
                                    [maxDate]="maxDate" 
                                    [readonlyInput]="true" 
                                    dateFormat="dd/mm/yy" 
                                    [inline]="true"
                                    class="w-full"
                                />
                            </div>
                        </div>
                      
                        <div class="bg-gray-50 p-5 rounded-xl shadow-inner border border-gray-200">
                            <h2 class="text-xl font-bold text-gray-900 mb-4">Available Slots</h2>
                            
                            <p-scrollPanel [style]="{ width: '100%', height: '400px' }">
                                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 p-1">
                                    <ng-container *ngIf="slots_for_display.length === 0; else slots_available">
                                        <div class="col-span-full text-center py-12">
                                            <h3 class="text-gray-600 font-medium">No Slots Available for this date.</h3>
                                        </div>
                                    </ng-container>
                                    <ng-template #slots_available>
                                        <div *ngFor="let slot of slots_for_display" class="col-span-1 mt-3">
                                            <button type="button" (click)="confirmSlot(slot)"
                                                class="w-full h-12 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded-xl flex items-center justify-center shadow-md transition duration-200">
                                                {{ slot.time | date: 'shortTime' }}
                                            </button>
                                        </div>
                                    </ng-template>
                                </div>
                            </p-scrollPanel>
                        </div>
                    </div>
                </div>

                <div *ngIf="selectedTab === 'services'" class="bg-white" role="tabpanel">
                    
                    <div class="mt-4 p-6 bg-gray-50 rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Have any doubts?</h3>
                        <p class="text-gray-700 mb-4">You can connect with Dr. {{(doctor.firstName | capitalizeFirst) + ' ' + (doctor.lastName | capitalizeFirst)}} before booking:</p>
                        <button (click)="chat()" 
                                class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-xl font-semibold shadow-md transition duration-200">
                            Chat with Doctor
                        </button>
                    </div>
                    
                    <div class="mt-6 p-6 bg-gray-50 rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Online Consultation Start</h3>
                        <p class="text-gray-700 mb-4">Click here to start your scheduled video/audio consultation:</p>
                        <button (click)="upcomingSlotDetails()" 
                                class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-xl font-semibold shadow-md transition duration-200">
                            Click here to start
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <app-footer></app-footer>
    <app-confirmation-modal [showModal]="showModal" message="Are you sure to confirm this slot?" (confirm)="onConfirmSlot()" (cancel)="onCancelSlot()"></app-confirmation-modal>
</div>